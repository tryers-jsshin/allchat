# AllChat - 통합 메신저 상담 관리 시스템 PRD

## 1. 제품 개요

### 1.1 제품명
AllChat - 통합 메신저 상담 관리 시스템

### 1.2 제품 설명
여러 메신저 플랫폼(카카오톡, 인스타그램 DM, 네이버 톡톡, WeChat, LINE)의 고객 문의를 하나의 통합 인터페이스에서 관리할 수 있는 고객 상담 관리 시스템

### 1.3 대상 사용자
- 고객 서비스 상담원
- 의료/미용 업계 상담 직원
- 멀티채널 고객 응대가 필요한 비즈니스

## 2. 기술 스택

- **Framework**: Next.js 15.5.0 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS v4
- **UI Components**: shadcn/ui
- **State Management**: React hooks (useState, useEffect, useRef)
- **Icons**: Lucide React

## 3. 주요 기능

### 3.1 고객 리스트 (좌측 패널)

#### 3.1.1 고객 정보 표시
- 고객명
- 프로필 아바타
- 채널 아이콘 (카카오톡, 인스타그램, 네이버, WeChat, LINE)
- 마지막 메시지 미리보기
- 마지막 메시지 시간 (오늘/어제/날짜 형식 구분)
- 읽지 않은 메시지 카운트 배지
- 상담 상태 표시
- 진행 중 고객 좌측 빨간색 보더 인디케이터

#### 3.1.2 상태 필터링
- 전체
- 진행 중 (주황색 카운트 표시)
- 보류
- 고객 대기
- 타 상담원 대기
- 완료

#### 3.1.3 상호작용
- 고객 선택 시 대화창 표시
- 선택된 고객 하이라이트
- 읽지 않은 메시지 자동 읽음 처리 (선택 즉시 카운트 0으로 리셋)
- 검색 필드 (X 버튼으로 검색어 지우기)

### 3.2 대화창 (중앙 패널)

#### 3.2.1 헤더
- 고객명 표시
- 채널 아이콘
- 상담 상태 드롭다운 (진행 중/완료)

#### 3.2.2 메시지 영역
- 날짜별 구분선
- 고객/상담원 메시지 구분 (좌/우 정렬)
- 메시지 시간 표시 (동일 시간대 연속 메시지는 마지막만 표시)
- 같은 발신자의 연속 메시지 간격 조절 (1px vs 4px)
- 자동 스크롤 (새 메시지 수신 시)
- 고객 메시지 호버 효과

#### 3.2.3 AI 답변 추천
- 고객 메시지 클릭 시 AI 답변 추천 팝업 표시
- 커스텀 프롬프트 입력 필드 (선택사항, placeholder: "어떻게 답변할까요? (선택)")
- AI 답변 생성 버튼 (sparkles 아이콘)
- 클릭 외부 영역 시 자동 닫기
- 팝업 열릴 때/닫힐 때 프롬프트 필드 초기화
- Enter 키로 즉시 생성 가능
- 톤 설정: custom(프롬프트 입력 시) / auto(미입력 시)

#### 3.2.4 입력 영역
- 멀티라인 텍스트 입력 (자동 높이 조절: 기본 40px, 최대 120px)
- 얇은 스크롤바 (1px width)
- 파일 첨부 버튼
- 전송 버튼
- 전송 후 입력창 자동 초기화 및 포커스 유지

### 3.3 상담 어시스턴트 (우측 패널)

#### 3.3.1 AI 탭
- AI 답변 추천 표시 (3가지 톤: 친절한 안내/전문적인 안내/간결한 안내)
- 로딩 인디케이터 (보라색 스피너 + "AI가 답변을 생성하고 있습니다..." 텍스트)
- 추천 답변 카드 (제목, 내용)
- 복사 버튼 (클립보드 복사)
- 복사 완료 피드백 ("복사됨!" 메시지, 체크 아이콘 변경)
- 즐겨찾기 기능 (별 아이콘)

#### 3.3.2 기본 탭
- 운영 정보 (접기/펼치기 가능)
  - 운영시간
  - 위치 정보  
  - 주차 안내
  - 예약 방법
  - 결제 수단
- 자주 사용하는 응대 문구 (접기/펼치기 가능)
  - 인사말
  - 대기 안내
  - 종료 인사
- 각 카드 클릭 시 확장/축소 애니메이션
- 복사 버튼 및 피드백

#### 3.3.3 시술 검색 탭
- 검색 필드 (X 버튼으로 검색어 지우기)
- 자동완성 드롭다운
  - 시술명만 표시 (가격, 시간 정보 제외)
  - 키보드 네비게이션 (화살표 키, Enter, Escape)
  - 선택된 항목 하이라이트
- 검색 결과 카드
  - 시술명
  - 가격 범위
  - 소요 시간
  - 시술 부위
  - 효과
  - 주의사항
- 의사별 시술 숙련도 표시
  - expert (숙련): 파란색 배경
  - available (가능): 초록색 배경
  - unavailable (불가): 빨간색 배경
- 시술 정보 즉시 복사 (형식화된 텍스트)

#### 3.3.4 참고 탭
- 카테고리별 메뉴얼 (접기/펼치기 가능)
  - 환불/교환
  - 배송
  - 회원가입
  - 결제
  - 기타
- 메뉴얼 카드 (제목, 내용, 태그)
- 섹션별 확장/축소 UI

## 4. UI/UX 특징

### 4.1 디자인 원칙
- 심플하고 직관적인 인터페이스
- 상담원의 업무 효율성 최우선
- 라이트 모드 전용 (다크 모드 미지원)
- 최소한의 시각적 요소

### 4.2 레이아웃
- 3분할 구조 (320px / flex-1 / 384px)
- 반응형 높이 (화면 전체 활용)
- 고정 헤더 (56px)

### 4.3 색상 테마
- Primary: 보라색 계열 (AI 기능 강조)
- Background: 흰색/연한 회색
- 텍스트: 명확한 대비

### 4.4 인터랙션
- 호버 효과
- 클릭 피드백
- 부드러운 전환 효과
- 자동 포커스 관리

## 5. 데이터 구조

### 5.1 Customer 타입
```typescript
{
  id: string
  name: string
  avatar?: string
  channel: 'kakao' | 'instagram' | 'naver' | 'wechat' | 'line'
  lastMessage: string
  lastMessageTime: Date
  status: MessageStatus
  unreadCount?: number
}
```

### 5.2 Message 타입
```typescript
{
  id: string
  customerId: string
  content: string
  timestamp: Date
  isFromCustomer: boolean
  channel: Channel
}
```

### 5.3 QuickReply 타입
```typescript
{
  id: string
  title: string
  content: string
  category: string
}
```

### 5.4 Manual 타입
```typescript
{
  id: string
  title: string
  content: string
  category: string
  tags: string[]
}
```

## 6. 상태 관리

### 6.1 전역 상태
- 고객 목록
- 선택된 고객 ID
- 메시지 목록 (고객별)
- 활성 어시스턴트 탭
- AI 추천 답변
- AI 로딩 상태

### 6.2 로컬 상태
- 입력 메시지
- 선택된 메시지 ID
- 커스텀 프롬프트
- 검색어
- 자동완성 옵션

## 7. 주요 이벤트 핸들러

- `handleSelectCustomer`: 고객 선택 (unreadCount 자동 0 설정)
- `handleSendMessage`: 메시지 전송 (상태 자동 'waiting-customer' 변경)
- `handleStatusChange`: 상담 상태 변경
- `handleCompleteChat`: 상담 완료
- `handleUseQuickReply`: 빠른 답변 복사
- `handleRequestAISuggestion`: AI 답변 요청

## 8. 상세 비즈니스 로직

### 8.1 상태 전환 규칙
- 메시지 전송 시 자동으로 'waiting-customer' 상태로 변경
- 고객 선택 시 unreadCount 즉시 0으로 리셋
- 상담 완료 후 재활성화 가능

### 8.2 메시지 그룹핑 로직
- 동일 시간대(분 단위) + 동일 발신자 = 하나의 그룹
- 그룹 내 마지막 메시지만 시간 표시
- 같은 발신자 연속 메시지: 1px 간격
- 다른 발신자 또는 다른 시간: 4px 간격

### 8.3 자동 높이 조절 로직
- 텍스트 입력창 기본 높이: 40px
- 내용에 따라 자동 확장
- 최대 높이: 120px
- 120px 초과 시 스크롤 활성화

### 8.4 AI 답변 생성 플로우
1. 고객 메시지 클릭
2. AI 추천 팝업 표시
3. 선택적 프롬프트 입력
4. AI 답변 생성 버튼 클릭 또는 Enter
5. 어시스턴트 패널 AI 탭 자동 전환
6. 로딩 인디케이터 표시
7. 3가지 톤의 답변 생성 (2초 딜레이)
8. 답변 카드 표시

## 9. Mock 데이터

- 10명의 샘플 고객
- 각 고객별 5-10개 메시지
- 6개 카테고리 빠른 답변
- 5개 카테고리 메뉴얼
- 시술 정보 데이터베이스

## 10. 개발 명령어

```bash
# 개발 서버 실행
npm run dev

# 빌드
npm run build

# 프로덕션 실행
npm start
```

## 11. 향후 개선 사항

### 11.1 계획된 기능
- 고객별 메모 기능 (재설계 예정)
- 실시간 메시지 동기화
- 파일 첨부 기능 구현
- 검색 기능 강화
- 상담 통계 대시보드

### 11.2 성능 최적화
- 메시지 가상 스크롤링
- 이미지 레이지 로딩
- 메모이제이션 적용

### 11.3 접근성
- 키보드 네비게이션
- 스크린 리더 지원
- ARIA 레이블 추가

## 12. 배포

- **Platform**: Vercel
- **Environment**: Production
- **URL**: [배포 예정]

## 13. 버전 히스토리

### v1.0.0 (현재)
- 기본 메신저 통합 기능
- AI 답변 추천
- 상담 어시스턴트
- 시술 검색
- 상태 관리

## 14. 보안 고려사항

- 클라이언트 사이드 데이터만 처리
- 민감 정보 마스킹
- XSS 방지
- CORS 정책 준수